<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${mode == 'edit' ? 'Todo編集' : '新規Todo作成'}">Todoフォーム</title>
</head>
<body th:replace="~{layout :: layout(~{::content})}">
<div th:fragment="content">

    <h2 th:text="${mode == 'edit' ? 'Todo編集' : '新規Todo作成'}">Todoフォーム</h2>

    <!-- 編集モード -->
    <form th:if="${mode == 'edit'}"
        th:object="${todoForm}"
        th:action="@{/todos/update/{id}(id=${todoForm.id})}"
        method="post">

        <!--必要な時のみ-->
        <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> -->

        <div>
            <label for="title">タイトル：</label>
            <input type="text" id="title" th:field="*{title}" required />
        </div>

        <div>
            <label for="description">詳細：</label>
            <textarea id="description" th:field="*{description}"></textarea>
        </div>

        <div>
            <label for="categoryId">カテゴリ：</label>
            <select id="categoryId" th:field="*{categoryId}">
                <option th:value="''">— 未選択 —</option>
                <option th:each="c : ${categories}"
                        th:value="${c.id}"
                        th:text="${c.name}"></option>
            </select>
        </div>

        <div>
            <label for="dueDate">期限：</label>
            <input type="date" id="dueDate" th:field="*{dueDate}" />
        </div>

        <div>
            <button type="submit">更新する</button>
            <a th:href="@{/todos}">戻る</a>
        </div>
    </form>

    <!-- 新規作成モード -->
    <form th:if="${mode != 'edit'}"
        th:object="${todoForm}"
        th:action="@{/todos}"
        method="post">

        <div>
            <label for="title">タイトル：</label>
            <input type="text" id="title" th:field="*{title}" required />
        </div>

        <div>
            <label for="description">詳細：</label>
            <textarea id="description" th:field="*{description}"></textarea>
        </div>

        <div>
            <label for="categoryId">カテゴリ：</label>
            <select id="categoryId" th:field="*{categoryId}">
                <option th:value="''">— 未選択 —</option>
                <option th:each="c : ${categories}"
                        th:value="${c.id}"
                        th:text="${c.name}"></option>
            </select>
        </div>

        <div>
            <label for="dueDate">期限：</label>
            <input type="date" id="dueDate" th:field="*{dueDate}" />
        </div>

        <div>
            <button type="submit">登録する</button>
            <a th:href="@{/todos}">戻る</a>
        </div>
    </form>

</div>
</body>
</html>
